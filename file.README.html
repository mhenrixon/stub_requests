<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.18
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1>StubRequests</h1>

<h2>Badges</h2>

<p><a href="https://travis-ci.org/mhenrixon/stub_requests"><img src="https://travis-ci.org/mhenrixon/stub_requests.svg?branch=master" alt="Build Status"></a> <a href="https://codeclimate.com/github/mhenrixon/stub_requests/maintainability"><img src="https://api.codeclimate.com/v1/badges/c9217e458c2a77fff1bc/maintainability" alt="Maintainability"></a> <a href="https://codeclimate.com/github/mhenrixon/stub_requests/test_coverage"><img src="https://api.codeclimate.com/v1/badges/c9217e458c2a77fff1bc/test_coverage" alt="Test Coverage"></a></p>

<p>This gem attempts to solve a problem I&#39;ve had for the time with WebMock.</p>

<p>When something changes, I have to update every single stub_request.</p>

<p>This gem allows me to only update the crucial parts while abstracting away things like service URI&#39;s, endpoint definitions and focus on the important things.</p>

<p>This is achieve by keeping a registry over the service endpoints.</p>

<!-- MarkdownTOC -->

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a>

<ul>
<li><a href="#register-service-endpoints">Register service endpoints</a></li>
<li><a href="#stubbing-service-endpoints">Stubbing service endpoints</a></li>
<li><a href="#metrics">Metrics</a></li>
</ul></li>
<li><a href="#future-improvements">Future Improvements</a>

<ul>
<li><a href="#api-client-gem">API Client Gem</a></li>
</ul></li>
<li><a href="#development">Development</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
</ul>

<!-- /MarkdownTOC -->

<p><a id="installation"></a></p>

<h2>Installation</h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stub_requests</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>And then execute:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span>
</code></pre>

<p>Or install it yourself as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_stub_requests'>stub_requests</span>
</code></pre>

<p><a id="usage"></a></p>

<h2>Usage</h2>

<p>To use the gem we need to register some service endpoints. In the following example we are connecting to a rails inspired service.</p>

<p>The naming of the <code>service_id</code> and <code>endpoint_id</code>&#39;s is irrelevant. This is just how we look things up in the registry.</p>

<p><a id="register-service-endpoints"></a></p>

<h3>Register service endpoints</h3>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="StubRequests.html" title="StubRequests (module)">StubRequests</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register_service'><span class='object_link'><a href="StubRequests/API.html#register_service-instance_method" title="StubRequests::API#register_service (method)">register_service</a></span></span><span class='lparen'>(</span><span class='symbol'>:google_ads</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://api.google.com/v5</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='symbol'>:index</span><span class='comma'>,</span> <span class='symbol'>:get</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ads</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='symbol'>:show</span><span class='comma'>,</span> <span class='symbol'>:get</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ads/:id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='symbol'>:update</span><span class='comma'>,</span> <span class='symbol'>:patch</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ads/:id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='symbol'>:create</span><span class='comma'>,</span> <span class='symbol'>:post</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ads</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_register'>register</span><span class='lparen'>(</span><span class='symbol'>:destroy</span><span class='comma'>,</span> <span class='symbol'>:delete</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ads/:id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>Now we have a list of endpoints we can stub.</p>

<p><a id="stubbing-service-endpoints"></a></p>

<h3>Stubbing service endpoints</h3>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="StubRequests.html" title="StubRequests (module)">StubRequests</a></span></span><span class='period'>.</span><span class='id identifier rubyid_stub_endpoint'><span class='object_link'><a href="StubRequests/API.html#stub_endpoint-instance_method" title="StubRequests::API#stub_endpoint (method)">stub_endpoint</a></span></span><span class='lparen'>(</span><span class='symbol'>:google_ads</span><span class='comma'>,</span> <span class='symbol'>:index</span><span class='rparen'>)</span>
            <span class='period'>.</span><span class='id identifier rubyid_to_return'>to_return</span><span class='lparen'>(</span><span class='label'>code:</span> <span class='int'>204</span><span class='comma'>,</span> <span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># This is the equivalent of doing the following in WebMock
</span><span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_google_ads_base_uri'>google_ads_base_uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://api.google.com/v5</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>WebMock</span><span class='period'>.</span><span class='id identifier rubyid_stub_request'>stub_request</span><span class='lparen'>(</span><span class='symbol'>:get</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_google_ads_base_uri'>google_ads_base_uri</span><span class='embexpr_end'>}</span><span class='tstring_content'>/ads</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
       <span class='period'>.</span><span class='id identifier rubyid_to_return'>to_return</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='int'>204</span><span class='comma'>,</span> <span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="StubRequests.html" title="StubRequests (module)">StubRequests</a></span></span><span class='period'>.</span><span class='id identifier rubyid_stub_endpoint'><span class='object_link'><a href="StubRequests/API.html#stub_endpoint-instance_method" title="StubRequests::API#stub_endpoint (method)">stub_endpoint</a></span></span><span class='lparen'>(</span><span class='symbol'>:google_ads</span><span class='comma'>,</span> <span class='symbol'>:update</span><span class='comma'>,</span> <span class='label'>id:</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='label'>body:</span> <span class='id identifier rubyid_request_body'>request_body</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_to_return'>to_return</span><span class='lparen'>(</span><span class='label'>code:</span> <span class='int'>200</span><span class='comma'>,</span> <span class='label'>body:</span> <span class='id identifier rubyid_response_body'>response_body</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='comment'># This is the equivalent of doing the following in WebMock
</span><span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_google_ads_base_uri'>google_ads_base_uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://api.google.com/v5</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>WebMock</span><span class='period'>.</span><span class='id identifier rubyid_stub_request'>stub_request</span><span class='lparen'>(</span><span class='symbol'>:patch</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Settings</span><span class='period'>.</span><span class='id identifier rubyid_google_ads_base_uri'>google_ads_base_uri</span><span class='embexpr_end'>}</span><span class='tstring_content'>/ads/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
       <span class='period'>.</span><span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='label'>body:</span> <span class='id identifier rubyid_request_body'>request_body</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
       <span class='period'>.</span><span class='id identifier rubyid_to_return'>to_return</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='int'>200</span><span class='comma'>,</span> <span class='label'>body:</span> <span class='id identifier rubyid_response_body'>response_body</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='rparen'>)</span>
</code></pre>

<p>This reduces the need to spread out URI&#39;s in the test suite without having to resort to shared examples.</p>

<p><a id="metrics"></a></p>

<h3>Metrics</h3>

<p>Metrics collection are by default turned off. It can be turned on by the following code.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="StubRequests.html" title="StubRequests (module)">StubRequests</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="StubRequests.html#configure-instance_method" title="StubRequests#configure (method)">configure</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_record_metrics'>record_metrics</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</code></pre>

<p><a id="future-improvements"></a></p>

<h2>Future Improvements</h2>

<p><a id="api-client-gem"></a></p>

<h3>API Client Gem</h3>

<p>Since we have a service + endpoint registry, I was thinking it might make
sense to make this into an API client. Not sure yet, maybe this will become multiple gems in the future so that someone can pick and choose.</p>

<p>Anyway, the idea was to provide endpoint calls in production and stubbed
requests in tests using the same registry.</p>

<p><a id="development"></a></p>

<h2>Development</h2>

<p>After checking out the repo, run <code>bin/setup</code> to install dependencies.</p>

<p>Then, run <code>rake spec</code> to run the tests. You can also run <code>bin/console</code> for an
interactive prompt that will allow you to experiment.</p>

<p>To install this gem onto your local machine run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>

<p><a id="contributing"></a></p>

<h2>Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at:
<a href="https://github.com/mhenrixon/stub_requests">issues</a>.</p>

<p>This project is intended to be a safe, welcoming space for collaboration, and
contributors are expected to adhere to the <a href="cc">Contributor Covenant</a> code of conduct.</p>

<p><a id="license"></a></p>

<h2>License</h2>

<p>The gem is available as open source under the terms of the <a href="mit">MIT License</a>.</p>

<p><a id="code-of-conduct"></a></p>

<h2>Code of Conduct</h2>

<p>Everyone interacting in the StubRequests projectâ€™s codebases, issue trackers,
chat rooms and mailing lists is expected to follow the <a href="coc">code of conduct</a>.</p>
</div></div>

      <div id="footer">
  Generated on Sun Feb  3 21:08:26 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.18 (ruby-2.3.8).
</div>

    </div>
  </body>
</html>